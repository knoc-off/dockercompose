version: "3.7"

services:

  NCDatabase:
    restart: always
    image: "mariadb:latest"

    volumes:
      - "/opt/dockerdata/nextcloud/NCMariaDB:/var/lib/mysql"

    environment:
      - MYSQL_ROOT_PASSWORD
      - MYSQL_RANDOM_ROOT_PASSWORD
      - MYSQL_DATABASE
      - MYSQL_USER
      - MYSQL_PASSWORD

    restart: "on-failure"
      #networks: ["common"]

  NCFrontend:
    restart: always
    expose:
      - 80
      - 443
    image: "nextcloud:latest"

    volumes: 
          - "/opt/dockerdata/nextcloud/NCData:/var/www/html"

    environment:
      - LETSENCRYPT_HOST
      - VIRTUAL_HOST
      - TRUSTED_PROXIES
      - OVERWRITEPROTOCOL
      - MYSQL_DATABASE
      - MYSQL_USER
      - MYSQL_PASSWORD
      - MYSQL_HOST
      - SMTP_HOST
      - SMTP_PORT
      - SMTP_NAME
      - SMTP_PASSWORD
      - MAIL_FROM_ADDRESS
      - NEXTCLOUD_TRUSTED_DOMAINS
      - NEXTCLOUD_ADMIN_USER
      - NEXTCLOUD_ADMIN_PASSWORD

    depends_on:
      - "NCDatabase"
        #networks: ["net", "common"]

volumes:
  NCMariaDB:
  NCData:


networks:
  default:
    name: nginx-proxy
    external: true
